---
# defaults file for ansible-cis_rhel8-role

_list_CIS_partitions:
  - "/tmp"
  - "/var"
  - "/var/tmp"
  - "/var/log"
  - "/var/log/audit"
  - "/home"

_gnome_in_use: false

# value accept multiple users/groups, space sparated
_sshd_access_limited:
  - directive: AllowUsers
    value: ""
  - directive: AllowGroups
    value: ""
  - directive: DenyUsers
    value: ""
  - directive: DenyGroups
    value: ""

_permitted_sudo_nopassword:
  - jenkins
  - defcon1

excluded_local_users:
  - ec2-user
  - jenkins
  - defcon1

rules:
  # 1 - Initial Setup
  rule_1_1_1_1:
    description: 1.1.1.1 Ensure mounting of cramfs filesystems is disabled
    enabled: true
    scored: true
    severity: low
    status: ''
    check:
      - command: modprobe -n -v cramfs| egrep -c "^install\s*/bin/true($|\s*)"
        expected: "1"
      - command: lsmod | grep -c cramfs
        expected: "0"
  rule_1_1_1_2:
    description: 1.1.1.2 Ensure mounting of vFAT filesystems is limited (Not Scored)
    enabled: true
    scored: false
    severity: low
    status: ''
    check:
      - command: modprobe -n -v vfat| egrep -c "^install\s*/bin/true($|\s*)"
        expected: "1"
      - command: lsmod | grep -c vfat
        expected: "0"
  rule_1_1_1_3:
    description: 1.1.1.3 Ensure mounting of squashfs filesystems is disabled
    enabled: true
    scored: true
    severity: low
    status: ''
    check:
      - command: modprobe -n -v squashfs| egrep -c "^install\s*/bin/true($|\s*)"
        expected: "1"
      - command: lsmod | grep -c squashfs
        expected: "0"
  rule_1_1_1_4:
    description: 1.1.1.4 Ensure mounting of udf filesystems is disabled
    enabled: true
    scored: true
    severity: low
    status: ''
    check:
      - command: modprobe -n -v udf| egrep -c "^install\s*/bin/true($|\s*)"
        expected: "1"
      - command: lsmod | grep -c udf
        expected: "0"
  rule_1_1_2:
    description: 1.1.2 Ensure /tmp is configured
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: mount| grep -cE ' /tmp(\/)? '
        expected: "1"
  rule_1_1_3:
    description: 1.1.3 Ensure nodev option set on /tmp partition
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: "mount| grep ' /tmp '| grep -c nodev"
        expected: "1"
  rule_1_1_4:
    description: 1.1.4 Ensure nosuid option set on /tmp partition
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: "mount| grep ' /tmp '| grep -c nosuid"
        expected: "1"
  rule_1_1_5:
    description: 1.1.5 Ensure noexec option set on /tmp partition
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: "mount| grep ' /tmp '| grep -c noexec"
        expected: "1"
  rule_1_1_6:
    description: 1.1.6 Ensure separate partition exists for /var
    enabled: true
    scored: true
    severity: low
    status: ''
    check:
      - command: cat /etc/fstab | grep -cE ' /var(\/)? '
        expected: "1"
      - command: "mount| grep -c ' /var '"
        expected: "1"
  rule_1_1_7:
    description: 1.1.7 Ensure separate partition exists for /var/tmp
    enabled: false
    observations: "does not apply, on-premise images have no separate partition"
    scored: true
    severity: low
    status: ''
    check:
      - command: cat /etc/fstab | grep -cE ' /var/tmp(\/)? '
        expected: "1"
      - command: "mount| grep -c ' /var/tmp '"
        expected: "1"
  rule_1_1_8:
    description: 1.1.8 Ensure nodev option set on /var/tmp partition
    enabled: false
    observations: "does not apply, on-premise images have no separate partition"
    scored: true
    severity: medium
    status: ''
    check:
      - command: "mount| grep ' /var/tmp '| grep -c nodev"
        expected: "1"
  rule_1_1_9:
    description: 1.1.9 Ensure nosuid option set on /var/tmp partition
    enabled: false
    observations: "does not apply, on-premise images have no separate partition"
    scored: true
    severity: medium
    status: ''
    check:
      - command: "mount| grep ' /var/tmp '| grep -c nosuid"
        expected: "1"
  rule_1_1_10:
    description: 1.1.10 Ensure noexec option set on /var/tmp partition
    enabled: false
    observations: "does not apply, on-premise images have no separate partition"
    scored: true
    severity: medium
    status: ''
    check:
      - command: "mount| grep ' /var/tmp '| grep -c noexec"
        expected: "1"
  rule_1_1_11:
    description: 1.1.11 Ensure separate partition exists for /var/log
    enabled: false
    observations: "does not apply, on-premise images have no separate partition"
    scored: true
    severity: medium
    status: ''
    check:
      - command: cat /etc/fstab | grep -cE ' /var/log(\/)? '
        expected: "1"
      - command: "mount| grep -c ' /var/log '"
        expected: "1"
  rule_1_1_12:
    description: 1.1.12 Ensure separate partition exists for /var/log/audit
    enabled: true
    scored: true
    severity: low
    status: ''
    check:
      - command: cat /etc/fstab | grep -cE ' /var/log/audit(\/)? '
        expected: "1"
      - command: "mount| grep -c ' /var/log/audit '"
        expected: "1"
  rule_1_1_13:
    description: 1.1.13 Ensure separate partition exists for /home
    enabled: true
    scored: true
    severity: low
    status: ''
    check:
      - command: cat /etc/fstab | grep -cE ' /home(\/)? '
        expected: "1"
      - command: "mount| grep -c ' /home '"
        expected: "1"
  rule_1_1_14:
    description: 1.1.14 Ensure nodev option set on /home partition
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: "mount| grep ' /home '| grep -c nodev"
        expected: "1"
  rule_1_1_15:
    description: 1.1.15 Ensure nodev option set on /dev/shm partition
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: "mount| grep ' /dev/shm '| grep -c nodev"
        expected: "1"
  rule_1_1_16:
    description: 1.1.16 Ensure nosuid option set on /dev/shm partition
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: "mount| grep ' /dev/shm '| grep -c nosuid"
        expected: "1"
  rule_1_1_17:
    description: 1.1.17 Ensure noexec option set on /dev/shm partition
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: "mount| grep ' /dev/shm '| grep -c noexec"
        expected: "1"
  rule_1_1_18:
    description: 1.1.18 Ensure nodev option set on removable media partitions (Not Scored)
    enabled: false
    observations: "does not apply, removable drive are not permitted"
    not_supported: true
    scored: false
    severity: medium
    status: ''
  rule_1_1_19:
    description: 1.1.19 Ensure nosuid option set on removable media partitions (Not Scored)
    enabled: false
    observations: "does not apply, removable drive are not permitted"
    not_supported: true
    scored: false
    severity: medium
    status: ''
  rule_1_1_20:
    description: 1.1.20 Ensure noexec option set on removable media partitions (Not Scored)
    enabled: false
    observations: "does not apply, removable drive are not permitted"
    not_supported: true
    scored: false
    severity: medium
    status: ''
  rule_1_1_21:
    description: 1.1.21 Ensure sticky bit is set on all world-writable directories
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: df --local -P | awk {'if (NR!=1) print $6'} | xargs -I '{}' find '{}' -xdev -type d \( -perm -0002 -a ! -perm -1000 \) 2>/dev/null | wc -l
        expected: "0"
  rule_1_1_22:
    description: 1.1.22 Disable Automounting
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: "systemctl is-enabled autofs 2>/dev/null | grep -c enabled"
        expected: "0"
  rule_1_1_23:
    description: 1.1.23 Disable USB Storage
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: modprobe -n -v usb-storage| egrep -c "^install\s*/bin/true($|\s*)"
        expected: "1"
      - command: "lsmod | grep -c usb-storage"
        expected: "0"
  rule_1_2_1:
    description: 1.2.1 Ensure Red Hat Subscription Manager connection is configured (Not Scored)
    enabled: false
    observations: "it's not mandatory to subscribe the system to RHN"
    scored: false
    severity: low
    status: ''
    check:
      - command: subscription-manager identity 2>&1|grep -c "system identity:"
        expected: "1"
  rule_1_2_2:
    description: 1.2.2 Disable the rhnsd Daemon (Not Scored)
    enabled: true
    scored: false
    severity: low
    status: ''
    check:
      - command: systemctl is-enabled rhnsd 2>&1| grep -c enabled
        expected: "0"
  rule_1_2_3:
    description: 1.2.3 Ensure GPG keys are configured (Not Scored)
    enabled: true
    scored: false
    severity: critical
    status: ''
    check:
      - command: rpm -q gpg-pubkey --qf '%{name}-%{version}-%{release} --> %{summary}\n'|wc -l
        expected: "1"
        parameter: "-gt"
  rule_1_2_4:
    description: 1.2.4 Ensure gpgcheck is globally activated
    enabled: false
    observations: "not manageable with current infrastructure, supported but intentionally disabled"
    scored: true
    severity: critical
    status: ''
    check:
      - command: grep ^gpgcheck /etc/yum.conf|wc -l
        expected: "0"
        parameter: "-gt"
      - command: grep ^gpgcheck /etc/yum.repos.d/*|wc -l
        expected: "0"
        parameter: "-gt"
  rule_1_2_5:
    description: 1.2.5 Ensure package manager repositories are configured (Not Scored)
    enabled: false
    observations: "it's not mandatory to have configured repos"
    not_supported: true
    scored: false
    severity: low
    status: ''
  rule_1_3_1:
    description: 1.3.1 Ensure sudo is installed
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: if [[ -f /tmp/rpm_packages ]]; then grep -c sudo /tmp/rpm_packages; else touch ./skip_rpm; fi
        expected: "0"
        parameter: "-gt"
  rule_1_3_2:
    description: 1.3.2 Ensure sudo commands use pty
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: grep -Ei '^\s*Defaults\s+(\[^#]+,\s*)?use_pty' /etc/sudoers /etc/sudoers.d/*| wc -l
        expected: "0"
        parameter: "-gt"
  rule_1_3_3:
    description: 1.3.3 Ensure sudo log file exists
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: grep -Ei '^\s*Defaults\s+([^#]+,\s*)?logfile=' /etc/sudoers /etc/sudoers.d/*| grep -c '/var/log/sudo.log'
        expected: "0"
        parameter: "-gt"
  rule_1_4_1:
    description: 1.4.1 Ensure AIDE is installed
    enabled: false
    observations: "AIDE is not installed"
    scored: true
    severity: medium
    status: ''
    check:
      - command: if [[ -f /tmp/rpm_packages ]]; then grep -c aide /tmp/rpm_packages; else touch ./skip_rpm; fi
        expected: "0"
        parameter: "-gt"
  rule_1_4_2:
    description: 1.4.2 Ensure filesystem integrity is regularly checked
    enabled: false
    observations: "AIDE is not installed"
    scored: true
    severity: medium
    status: ''
  rule_1_5_1:
    description: 1.5.1 Ensure permissions on bootloader config are configured
    enabled: true
    scored: true
    severity: critical
    status: ''
    check:
      - command: stat /boot/grub2/grub.cfg| grep -c 'Access:\s*(0600/-rw-------)\s*Uid:.*root.*Gid:.*root)$'
        expected: "1"
  rule_1_5_2:
    description: 1.5.2 Ensure bootloader password is set
    enabled: false
    observations: password on bootloader is not configured by default
    scored: true
    severity: critical
    status: ''
    check:
      - command: grep -c '^\s*GRUB2_PASSWORD' /boot/grub2/user.cfg
        expected: "0"
        parameter: "-gt"
  rule_1_5_3:
    description: 1.5.3 Ensure authentication required for single user mode
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: grep -c 'ExecStart=-/usr/lib/systemd/systemd-sulogin-shell rescue' /usr/lib/systemd/system/rescue.service
        expected: "1"
      - command: grep -c 'ExecStart=-/usr/lib/systemd/systemd-sulogin-shell emergency' /usr/lib/systemd/system/emergency.service
        expected: "1"
  rule_1_6_1:
    description: 1.6.1 Ensure core dumps are restricted
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: sudo  grep "hard core" /etc/security/limits.conf /etc/security/limits.d/* 2>/dev/null| wc -l
        expected: "0"
        parameter: "-gt"
      - command: sysctl fs.suid_dumpable| grep -c "^fs.suid_dumpable\s*=\s*0$"
        expected: "0"
        parameter: "-gt"
      - command: grep "fs\.suid_dumpable" /etc/sysctl.conf /etc/sysctl.d/* 2>/dev/null| wc -l
        expected: "0"
        parameter: "-gt"
  rule_1_6_2:
    description: 1.6.2 Ensure address space layout randomization (ASLR) is enabled
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: sysctl kernel.randomize_va_space| grep -c 'kernel.randomize_va_space\s*=\s*2'
        expected: "1"
  rule_1_7_1_1:
    description: 1.7.1.1 Ensure SELinux is installed
    enabled: true
    scored: true
    severity: critical
    status: ''
    check:
      - command: if [[ -f /tmp/rpm_packages ]]; then grep -c libselinux /tmp/rpm_packages; else touch ./skip_rpm; fi
        expected: "0"
        parameter: "-gt"
  rule_1_7_1_2:
    description: 1.7.1.2 Ensure SELinux is not disabled in bootloader configuration
    enabled: true
    scored: true
    severity: critical
    status: ''
    check:
      - command: grep "^\s*linux" /boot/grub2/grub.cfg | grep -cE "(selinux=0|enforcing=0)"
        expected: "0"
  rule_1_7_1_3:
    description: 1.7.1.3 Ensure SELinux policy is configured
    enabled: true
    scored: true
    severity: critical
    status: ''
    check:
      - command: grep -c SELINUXTYPE=targeted /etc/selinux/config
        expected: "1"
  rule_1_7_1_4:
    description: 1.7.1.4 Ensure the SELinux state is enforcing
    enabled: true
    scored: true
    severity: critical
    status: ''
    check:
      - command: grep -c SELINUX=enforcing /etc/selinux/config
        expected: "1"
  rule_1_7_1_5:
    description: 1.7.1.5 Ensure no unconfined services exist
    enabled: true
    scored: true
    severity: critical
    status: ''
    check:
      - command: ps -eZ | grep -c unconfined_service_t
        expected: "0"
  rule_1_7_1_6:
    description: 1.7.1.6 Ensure SETroubleshoot is not installed
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: if [[ -f /tmp/rpm_packages ]]; then grep -c setroubleshoot /tmp/rpm_packages; else touch ./skip_rpm; fi
        expected: "0"
  rule_1_7_1_7:
    description: 1.7.1.7 Ensure the MCS Translation Service (mcstrans) is not installed
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: if [[ -f /tmp/rpm_packages ]]; then grep -c mcstrans /tmp/rpm_packages; else touch ./skip_rpm; fi
        expected: "0"
  rule_1_8_1_1:
    description: 1.8.1.1 Ensure message of the day is configured properly
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: grep -E -i "(\\\v|\\\r|\\\m|\\\s)" /etc/motd|wc -l
        expected: "0"
  rule_1_8_1_2:
    description: 1.8.1.2 Ensure local login warning banner is configured properly
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: grep -E -i "(\\\v|\\\r|\\\m|\\\s)" /etc/issue|wc -l
        expected: "0"
  rule_1_8_1_3:
    description: 1.8.1.3 Ensure remote login warning banner is configured properly
    enabled: true
    scored: true
    severity: low
    status: ''
    check:
      - command: grep -E -i "(\\\v|\\\r|\\\m|\\\s)" /etc/issue.net|wc -l
        expected: "0"
  rule_1_8_1_4:
    description: 1.8.1.4 Ensure permissions on /etc/motd are configured
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: stat /etc/motd| grep -c 'Access:\s*(0644/-rw-[-r]--[-r]--)\s*Uid:.*root.*Gid:.*root)$'
        expected: "1"
  rule_1_8_1_5:
    description: 1.8.1.5 Ensure permissions on /etc/issue are configured
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: stat /etc/issue| grep -c 'Access:\s*(0644/-rw-[-r]--[-r]--)\s*Uid:.*root.*Gid:.*root)$'
        expected: "1"
  rule_1_8_1_6:
    description: 1.8.1.6 Ensure permissions on /etc/issue.net are configured
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: stat /etc/issue.net| grep -c 'Access:\s*(0644/-rw-[-r]--[-r]--)\s*Uid:.*root.*Gid:.*root)$'
        expected: "1"
  rule_1_8_2:
    description: 1.8.2 Ensure GDM login banner is configured
    enabled: false
    observations: "GNOME Desktop Environment should not be installed"
    scored: true
    severity: medium
    status: ''
  rule_1_9:
    description: 1.9 Ensure updates, patches, and additional security software are installed
    enabled: true
    scored: true
    severity: critical
    status: ''
    check:
      - command: dnf check-update --security -q >/dev/null 2>&1; [ $? -eq 100 ] && { echo 1; } || { echo 0; }
        expected: "0"
  rule_1_10:
    description: 1.10 Ensure system-wide crypto policy is not legacy
    enabled: false
    observations: "this rule has been intentionally disabled, DEFAULT setting used"
    not_supported: true
    scored: true
    severity: critical
    status: ''
  rule_1_11:
    description: 1.11 Ensure system-wide crypto policy is FUTURE or FIPS
    enabled: false
    observations: "crypto policy to FUTURE or FIPS cannot be activated because excludes ciphers used by Sebasshtian"
    scored: true
    severity: critical
    status: ''
    check:
      - command: grep -E -i '^\s*(FUTURE|FIPS)\s*(\s+#.*)?$' /etc/crypto-policies/config|wc -l
        expected: "0"
        parameter: "-gt"

  # 2 - Services
  rule_2_1_1:
    description: 2.1.1 Ensure xinetd is not installed
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: if [[ -f /tmp/rpm_packages ]]; then grep -c xinetd /tmp/rpm_packages; else touch ./skip_rpm; fi
        expected: "0"
  rule_2_2_1_1:
    description: 2.2.1.1 Ensure time synchronization is in use (Not Scored)
    enabled: false
    observations: "time synchronization is left untouched"
    not_supported: true
    scored: false
    severity: medium
    status: ''
  rule_2_2_1_2:
    description: 2.2.1.2 Ensure chrony is configured
    enabled: false
    observations: "time synchronization is left untouched"
    not_supported: true
    scored: true
    severity: medium
    status: ''
  rule_2_2_2:
    description: 2.2.2 Ensure X Window System is not installed
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: systemctl status graphical.target 2>/dev/null 1>&2 && { echo 1; } || { echo 0; }
        expected: "0"
      - command: if [[ -f /tmp/rpm_packages ]]; then grep -c gnome-classic-session /tmp/rpm_packages; else touch ./skip_rpm; fi
        expected: "0"
  rule_2_2_3:
    description: 2.2.3 Ensure rsync service is not enabled
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: systemctl status rsync 2>/dev/null 1>&2 && { echo 1; } || { echo 0; }
        expected: "0"
  rule_2_2_4:
    description: 2.2.4 Ensure Avahi Server is not enabled
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: systemctl status avahi-daemon 2>/dev/null 1>&2 && { echo 1; } || { echo 0; }
        expected: "0"
  rule_2_2_5:
    description: 2.2.5 Ensure SNMP Server is not enabled
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: systemctl status snmpd 2>/dev/null 1>&2 && { echo 1; } || { echo 0; }
        expected: "0"
  rule_2_2_6:
    description: 2.2.6 Ensure HTTP Proxy Server is not enabled
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: systemctl status squid 2>/dev/null 1>&2 && { echo 1; } || { echo 0; }
        expected: "0"
  rule_2_2_7:
    description: 2.2.7 Ensure Samba is not enabled
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: systemctl status smb 2>/dev/null 1>&2 && { echo 1; } || { echo 0; }
        expected: "0"
  rule_2_2_8:
    description: 2.2.8 Ensure IMAP and POP3 server is not enabled
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: systemctl status dovecot 2>/dev/null 1>&2 && { echo 1; } || { echo 0; }
        expected: "0"
  rule_2_2_9:
    description: 2.2.9 Ensure HTTP server is not enabled
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: systemctl status httpd 2>/dev/null 1>&2 && { echo 1; } || { echo 0; }
        expected: "0"
  rule_2_2_10:
    description: 2.2.10 Ensure FTP Server is not enabled
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: systemctl status vsftpd 2>/dev/null 1>&2 && { echo 1; } || { echo 0; }
        expected: "0"
  rule_2_2_11:
    description: 2.2.11 Ensure DNS Server is not enabled
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: systemctl status named 2>/dev/null 1>&2 && { echo 1; } || { echo 0; }
        expected: "0"
  rule_2_2_12:
    description: 2.2.12 Ensure NFS is not enabled
    enabled: true
    scored: true
    severity: critical
    status: ''
    check:
      - command: systemctl status nfs 2>/dev/null 1>&2 && { echo 1; } || { echo 0; }
        expected: "0"
  rule_2_2_13:
    description: 2.2.13 Ensure RPC is not enabled
    enabled: true
    scored: true
    severity: critical
    status: ''
    check:
      - command: systemctl status rpcbind 2>/dev/null 1>&2 && { echo 1; } || { echo 0; }
        expected: "0"
  rule_2_2_14:
    description: 2.2.14 Ensure LDAP server is not enabled
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: systemctl status slapd 2>/dev/null 1>&2 && { echo 1; } || { echo 0; }
        expected: "0"
  rule_2_2_15:
    description: 2.2.15 Ensure DHCP Server is not enabled
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: systemctl status dhcpd 2>/dev/null 1>&2 && { echo 1; } || { echo 0; }
        expected: "0"
  rule_2_2_16:
    description: 2.2.16 Ensure CUPS is not enabled
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: systemctl status cups 2>/dev/null 1>&2 && { echo 1; } || { echo 0; }
        expected: "0"
  rule_2_2_17:
    description: 2.2.17 Ensure NIS Server is not enabled
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: systemctl status ypserv 2>/dev/null 1>&2 && { echo 1; } || { echo 0; }
        expected: "0"
  rule_2_2_18:
    description: 2.2.18 Ensure mail transfer agent is configured for local-only mode
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: ss -lntu | grep -E ':25\s' | grep -E -v '\s(127.0.0.1|\[::1\]):25\s'| wc -l
        expected: "0"
  rule_2_3_1:
    description: 2.3.1 Ensure NIS Client is not installed
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: if [[ -f /tmp/rpm_packages ]]; then grep -c ypbind /tmp/rpm_packages; else touch ./skip_rpm; fi
        expected: "0"
  rule_2_3_2:
    description: 2.3.2 Ensure telnet client is not installed
    enabled: true
    scored: true
    severity: low
    status: ''
    check:
      - command: if [[ -f /tmp/rpm_packages ]]; then grep -c telnet /tmp/rpm_packages; else touch ./skip_rpm; fi
        expected: "0"
  rule_2_3_3:
    description: 2.3.3 Ensure LDAP client is not installed
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: if [[ -f /tmp/rpm_packages ]]; then grep -c openldap-clients /tmp/rpm_packages; else touch ./skip_rpm; fi
        expected: "0"

  rule_3_1_1:
    description: 3.1.1 Ensure IP forwarding is disabled
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: sysctl net.ipv4.ip_forward |grep -c '^net.ipv4.ip_forward\s*=\s*0'
        expected: "1"
  rule_3_1_2:
    description: 3.1.2 Ensure packet redirect sending is disabled
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: sysctl net.ipv4.conf.all.send_redirects |grep -c '^net.ipv4.conf.all.send_redirects\s*=\s*0'
        expected: "1"
      - command: sysctl net.ipv4.conf.default.send_redirects |grep -c '^net.ipv4.conf.default.send_redirects\s*=\s*0'
        expected: "1"
  rule_3_2_1:
    description: 3.2.1 Ensure source routed packets are not accepted
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: sysctl net.ipv4.conf.all.accept_source_route|grep -c '^net.ipv4.conf.all.accept_source_route\s*=\s*0'
        expected: "1"
      - command: sysctl net.ipv4.conf.default.accept_source_route|grep -c '^net.ipv4.conf.default.accept_source_route\s*=\s*0'
        expected: "1"
  rule_3_2_2:
    description: 3.2.2 Ensure ICMP redirects are not accepted
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: sysctl net.ipv4.conf.all.accept_redirects|grep -c '^net.ipv4.conf.all.accept_redirects\s*=\s*0'
        expected: "1"
      - command: sysctl net.ipv4.conf.default.accept_redirects|grep -c '^net.ipv4.conf.default.accept_redirects\s*=\s*0'
        expected: "1"
  rule_3_2_3:
    description: 3.2.3 Ensure secure ICMP redirects are not accepted
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: sysctl net.ipv4.conf.all.secure_redirects|grep -c '^net.ipv4.conf.all.secure_redirects\s*=\s*0'
        expected: "1"
      - command: sysctl net.ipv4.conf.default.secure_redirects|grep -c '^net.ipv4.conf.default.secure_redirects\s*=\s*0'
        expected: "1"
  rule_3_2_4:
    description: 3.2.4 Ensure suspicious packets are logged
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: sysctl net.ipv4.conf.all.log_martians|grep -c '^net.ipv4.conf.all.log_martians\s*=\s*1'
        expected: "1"
      - command: sysctl net.ipv4.conf.default.log_martians|grep -c '^net.ipv4.conf.default.log_martians\s*=\s*1'
        expected: "1"
  rule_3_2_5:
    description: 3.2.5 Ensure broadcast ICMP requests are ignored
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: sysctl net.ipv4.icmp_echo_ignore_broadcasts|grep -c '^net.ipv4.icmp_echo_ignore_broadcasts\s*=\s*1'
        expected: "1"
  rule_3_2_6:
    description: 3.2.6 Ensure bogus ICMP responses are ignored
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: sysctl net.ipv4.icmp_ignore_bogus_error_responses|grep -c '^net.ipv4.icmp_ignore_bogus_error_responses\s*=\s*1'
        expected: "1"
  rule_3_2_7:
    description: 3.2.7 Ensure Reverse Path Filtering is enabled
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: sysctl net.ipv4.conf.all.rp_filter|grep -c '^net.ipv4.conf.all.rp_filter\s*=\s*1'
        expected: "1"
      - command: sysctl net.ipv4.conf.default.rp_filter|grep -c '^net.ipv4.conf.default.rp_filter\s*=\s*1'
        expected: "1"
  rule_3_2_8:
    description: 3.2.8 Ensure TCP SYN Cookies is enabled
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: sysctl net.ipv4.tcp_syncookies|grep -c '^net.ipv4.tcp_syncookies\s*=\s*1'
        expected: "1"
  rule_3_2_9:
    description: 3.2.9 Ensure IPv6 router advertisements are not accepted
    enabled: false
    observations: "IPv6 is disabled"
    scored: true
    severity: medium
    status: ''
    check:
      - command: sysctl net.ipv6.conf.all.accept_ra|grep -c '^net.ipv6.conf.all.accept_ra\s*=\s*0'
        expected: "1"
      - command: sysctl net.ipv6.conf.default.accept_ra|grep -c '^net.ipv6.conf.default.accept_ra\s*=\s*0'
        expected: "1"
  rule_3_3_1:
    description: 3.3.1 Ensure DCCP is disabled
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: modprobe -n -v dccp| egrep -c "^install\s*/bin/true($|\s*)"
        expected: "1"
      - command: "lsmod | grep -c dccp"
        expected: "0"
  rule_3_3_2:
    description: 3.3.2 Ensure SCTP is disabled
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: modprobe -n -v sctp| egrep -c "^install\s*/bin/true($|\s*)"
        expected: "1"
      - command: "lsmod | grep -c sctp"
        expected: "0"
  rule_3_3_3:
    description: 3.3.3 Ensure RDS is disabled
    enabled: true
    scored: true
    severity: low
    status: ''
    check:
      - command: modprobe -n -v rds| egrep -c "^install\s*/bin/true($|\s*)"
        expected: "1"
      - command: "lsmod | grep -c rds"
        expected: "0"
  rule_3_3_4:
    description: 3.3.4 Ensure TIPC is disabled
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: modprobe -n -v tipc| egrep -c "^install\s*/bin/true($|\s*)"
        expected: "1"
      - command: "lsmod | grep -c tipc"
        expected: "0"
  rule_3_4_1_1:
    description: 3.4.1.1 Ensure a Firewall package is installed
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: if [[ -f /tmp/rpm_packages ]]; then grep -c firewalld /tmp/rpm_packages; else touch ./skip_rpm; fi
        expected: "0"
        parameter: '-gt'
  rule_3_4_2_1:
    description: 3.4.2.1 Ensure firewalld service is enabled and running
    enabled: false
    observations: "firewall rules are disabled"
    scored: true
    severity: medium
    status: ''
    check:
      - command: "systemctl is-enabled firewalld 2>/dev/null | grep -c enabled"
        expected: "0"
        parameter: '-gt'
  rule_3_4_2_2:
    description: 3.4.2.2 Ensure iptables is not enabled
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: "systemctl is-enabled iptables 2>/dev/null | grep -c enabled"
        expected: "0"
  rule_3_4_2_3:
    description: 3.4.2.3 Ensure nftables is not enabled
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: systemctl is-enabled nftables 2>/dev/null | grep -c enabled
        expected: "0"
  rule_3_4_2_4:
    description: 3.4.2.4 Ensure default zone is set
    enabled: false
    observations: "firewall rules are disabled"
    scored: true
    severity: medium
    status: ''
    check:
      - command: firewall-cmd --get-default-zone 2>&1| grep -c public
        expected: "1"
  rule_3_4_2_5:
    description: 3.4.2.5 Ensure network interfaces are assigned to appropriate zone (Not Scored)
    enabled: false
    observations: "firewall rules are disabled"
    scored: false
    severity: medium
    status: ''
    check:
      - command: firewall-cmd --get-active-zones | grep -c  "interfaces"
        expected: "0"
        parameter: '-gt'
  rule_3_4_2_6:
    description: 3.4.2.6 Ensure unnecessary services and ports are not accepted (Not Scored)
    enabled: false
    observations: "firewall rules are disabled"
    not_supported: true
    scored: false
    severity: low
    status: ''
  rule_3_4_3_1:
    description: 3.4.3.1 Ensure iptables are flushed (Not Scored)
    enabled: false
    observations: "nftables is not supported"
    not_supported: true
    scored: false
    severity: low
    status: ''
  rule_3_4_3_2:
    description: 3.4.3.2 Ensure a table exists
    enabled: false
    observations: "nftables is not supported"
    not_supported: true
    scored: true
    severity: low
    status: ''
  rule_3_4_3_3:
    description: 3.4.3.3 Ensure base chains exist
    enabled: false
    observations: "nftables is not supported"
    not_supported: true
    scored: true
    severity: low
    status: ''
  rule_3_4_3_4:
    description: 3.4.3.4 Ensure loopback traffic is configured
    enabled: false
    observations: "nftables is not supported"
    not_supported: true
    scored: true
    severity: low
    status: ''
  rule_3_4_3_5:
    description: 3.4.3.5 Ensure outbound and established connections are configured (Not Scored)
    enabled: false
    observations: "nftables is not supported"
    not_supported: true
    scored: false
    severity: low
    status: ''
  rule_3_4_3_6:
    description: 3.4.3.6 Ensure default deny firewall policy
    enabled: false
    observations: "nftables is not supported"
    not_supported: true
    scored: true
    severity: low
    status: ''
  rule_3_4_3_7:
    description: 3.4.3.7 Ensure nftables service is enabled
    enabled: false
    observations: "nftables is not supported"
    not_supported: true
    scored: true
    severity: low
    status: ''
  rule_3_4_3_8:
    description: 3.4.3.8 Ensure nftables rules are permanent
    enabled: false
    observations: "nftables is not supported"
    not_supported: true
    scored: true
    severity: low
    status: ''
  rule_3_4_4_1_1:
    description: 3.4.4.1.1 Ensure default deny firewall policy
    enabled: false
    observations: "firewall rules are disabled"
    scored: true
    severity: low
    status: ''
    check:
      - command: iptables -L| grep -c "Chain INPUT (policy DROP)"
        expected: "1"
      - command: iptables -L| grep -c "Chain FORWARD (policy DROP)"
        expected: "1"
      - command: iptables -L| grep -c "Chain OUTPUT (policy DROP)"
        expected: "1"
  rule_3_4_4_1_2:
    description: 3.4.4.1.2 Ensure loopback traffic is configured
    enabled: false
    observations: "firewall rules are disabled"
    scored: true
    severity: low
    status: ''
    check:
      - command: 'iptables -L INPUT -v -n| grep -c "ACCEPT.*0.0.0.0/0.*0.0.0.0/0"'
        expected: "1"
      - command: 'iptables -L INPUT -v -n| grep -c "DROP.*127.0.0.0/8.*0.0.0.0/0"'
        expected: "1"
      - command: 'iptables -L OUTPUT -v -n| grep -c "ACCEPT.*0.0.0.0/0.*0.0.0.0/0"'
        expected: "1"
  rule_3_4_4_1_3:
    description: 3.4.4.1.3 Ensure outbound and established connections are configured (Not Scored)
    enabled: false
    observations: "firewall rules are disabled"
    scored: true
    severity: low
    status: ''
    check:
      - command: iptables -L OUTPUT -v -n| grep -c "ACCEPT\s*tcp.*0.0.0.0/0\s*0.0.0.0/0\s*state NEW,ESTABLISHED"
        expected: "1"
      - command: iptables -L OUTPUT -v -n| grep -c "ACCEPT\s*udp.*0.0.0.0/0\s*0.0.0.0/0\s*state NEW,ESTABLISHED"
        expected: "1"
      - command: iptables -L OUTPUT -v -n| grep -c "ACCEPT\s*icmp.*0.0.0.0/0\s*0.0.0.0/0\s*state NEW,ESTABLISHED"
        expected: "1"
      - command: iptables -L INPUT -v -n| grep -c "ACCEPT\s*tcp.*0.0.0.0/0\s*0.0.0.0/0\s*state ESTABLISHED"
        expected: "1"
      - command: iptables -L INPUT -v -n| grep -c "ACCEPT\s*udp.*0.0.0.0/0\s*0.0.0.0/0\s*state ESTABLISHED"
        expected: "1"
      - command: iptables -L INPUT -v -n| grep -c "ACCEPT\s*icmp.*0.0.0.0/0\s*0.0.0.0/0\s*state ESTABLISHED"
        expected: "1"
  rule_3_4_4_1_4:
    description: 3.4.4.1.4 Ensure firewall rules exist for all open ports
    enabled: false
    observations: "firewall rules are disabled"
    not_supported: true
    scored: true
    severity: low
    status: ''
  rule_3_4_4_2_1:
    description: 3.4.4.2.1 Ensure IPv6 default deny firewall policy
    enabled: false
    observations: "firewall rules are disabled"
    scored: true
    severity: low
    status: ''
    check:
      - command: ip6tables -L| grep -c "Chain INPUT (policy DROP)"
        expected: "1"
      - command: ip6tables -L| grep -c "Chain FORWARD (policy DROP)"
        expected: "1"
      - command: ip6tables -L| grep -c "Chain OUTPUT (policy DROP)"
        expected: "1"
  rule_3_4_4_2_2:
    description: 3.4.4.2.2 Ensure IPv6 loopback traffic is configured
    enabled: false
    observations: "firewall rules are disabled"
    scored: true
    severity: low
    status: ''
    check:
      - command: ip6tables -L INPUT -v -n| grep -c "ACCEPT.*lo.*::/0\s*::/0"
        expected: "1"
      - command: ip6tables -L INPUT -v -n| grep -c "DROP.*::/0\s*::/0
        expected: "1"
      - command: ip6tables -L OUTPUT -v -n| grep -c "ACCEPT.*lo\s*::/0\s*::/0"
        expected: "1"
  rule_3_4_4_2_3:
    description: 3.4.4.2.3 Ensure IPv6 outbound and established connections are configured (Not Scored)
    enabled: false
    observations: "firewall rules are disabled"
    scored: true
    severity: low
    status: ''
    check:
      - command: ip6tables -L OUTPUT -v -n| grep -c "ACCEPT\s*tcp.*::/0\s*::/0\s*state NEW,ESTABLISHED"
        expected: "1"
      - command: ip6tables -L OUTPUT -v -n| grep -c "ACCEPT\s*udp.*::/0\s*::/0\s*state NEW,ESTABLISHED"
        expected: "1"
      - command: ip6tables -L OUTPUT -v -n| grep -c "ACCEPT\s*icmp.*::/0\s*::/0\s*state NEW,ESTABLISHED"
        expected: "1"
      - command: ip6tables -L INPUT -v -n| grep -c "ACCEPT\s*tcp.*::/0\s*::/0\s*state ESTABLISHED"
        expected: "1"
      - command: ip6tables -L INPUT -v -n| grep -c "ACCEPT\s*udp.*::/0\s*::/0\s*state ESTABLISHED"
        expected: "1"
      - command: ip6tables -L INPUT -v -n| grep -c "ACCEPT\s*icmp.*::/0\s*::/0\s*state ESTABLISHED"
        expected: "1"
  rule_3_4_4_2_4:
    description: 3.4.4.2.4 Ensure IPv6 firewall rules exist for all open ports (Not Scored)
    enabled: false
    observations: "firewall rules are disabled"
    not_supported: true
    scored: false
    severity: low
    status: ''
  rule_3_5:
    description: 3.5 Ensure wireless interfaces are disabled
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: "ip link show up| grep -c wlan"
        expected: "0"
  rule_3_6:
    description: 3.6 Disable IPv6
    enabled: false
    observations: "IPv6 is in use"
    scored: true
    severity: medium
    status: ''
    check:
      - command: grep "^\s*linux" /boot/grub2/grub.cfg | grep -cv ipv6.disabled=1
        expected: "0"
        parameter: '-gt'

  rule_4_1_1_1:
    description: 4.1.1.1 Ensure auditd is installed
    enabled: true
    scored: true
    severity: critical
    status: ''
    check:
      - command: if [[ -f /tmp/rpm_packages ]]; then grep -c audit /tmp/rpm_packages; else touch ./skip_rpm; fi
        expected: "0"
        parameter: '-gt'
      - command: if [[ -f /tmp/rpm_packages ]]; then grep -c audit-libs /tmp/rpm_packages; else touch ./skip_rpm; fi
        expected: "0"
        parameter: '-gt'
  rule_4_1_1_2:
    description: 4.1.1.2 Ensure auditd service is enabled
    enabled: true
    scored: true
    severity: critical
    status: ''
    check:
      - command: systemctl is-enabled auditd 2>/dev/null| grep -c enabled
        expected: "1"
  rule_4_1_1_3:
    description: 4.1.1.3 Ensure auditing for processes that start prior to auditd is enabled
    enabled: true
    scored: true
    severity: critical
    status: ''
    check:
      - command: grep -E 'kernelopts=(\S+\s+)*audit=1\b' /boot/grub2/grubenv|wc -l
        expected: "0"
        parameter: '-gt'
  rule_4_1_1_4:
    description: 4.1.1.4 Ensure audit_backlog_limit is sufficient
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: grep -E 'kernelopts=(\S+\s+)*audit_backlog_limit=\S+\b' /boot/grub2/grubenv|wc -l
        expected: "0"
        parameter: '-gt'
  rule_4_1_2_1:
    description: 4.1.2.1 Ensure audit log storage size is configured
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: grep -c '^max_log_file\s*=\s*500' /etc/audit/auditd.conf
        expected: "1"
  rule_4_1_2_2:
    description: 4.1.2.2 Ensure audit logs are not automatically deleted
    enabled: true
    observations: "value intentionally set to ROTATE"
    scored: true
    severity: critical
    status: ''
    check:
      - command: grep -c '^max_log_file_action\s*=\s*ROTATE' /etc/audit/auditd.conf
        expected: "1"
  rule_4_1_2_3:
    description: 4.1.2.3 Ensure system is disabled when audit logs are full
    enabled: true
    observations: "value intentionally set to EMAIL"
    scored: true
    severity: medium
    status: ''
    check:
      - command: grep -c '^space_left_action\s*=\s*EMAIL' /etc/audit/auditd.conf
        expected: "1"
      - command: grep -c '^action_mail_acct\s*=\s*root' /etc/audit/auditd.conf
        expected: "1"
      - command: grep -c '^admin_space_left_action\s*=\s*ROTATE' /etc/audit/auditd.conf
        expected: "1"
  rule_4_1_3:
    description: 4.1.3 Ensure changes to system administration scope (sudoers) is collected
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: grep -c '^-w /etc/sudoers -p wa -k scope' /etc/audit/audit.rules
        expected: "1"
      - command: grep -c '^-w /etc/sudoers.d/ -p wa -k scope' /etc/audit/audit.rules
        expected: "1"
  rule_4_1_4:
    description: 4.1.4 Ensure login and logout events are collected
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: grep -c '^-w /var/log/faillog -p wa -k logins' /etc/audit/audit.rules
        expected: "1"
      - command: grep -c '^-w /var/log/lastlog -p wa -k logins' /etc/audit/audit.rules
        expected: "1"
  rule_4_1_5:
    description: 4.1.5 Ensure session initiation information is collected
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: grep -c '^-w /var/run/utmp -p wa -k session' /etc/audit/audit.rules
        expected: "1"
      - command: grep -c '^-w /var/log/wtmp -p wa -k logins' /etc/audit/audit.rules
        expected: "1"
      - command: grep -c '^-w /var/log/btmp -p wa -k logins' /etc/audit/audit.rules
        expected: "1"
  rule_4_1_6:
    description: 4.1.6 Ensure events that modify date and time information are collected
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: grep -c '^-a always,exit -F arch=b64 -S adjtimex -S settimeofday -k time-change' /etc/audit/audit.rules
        expected: "1"
      - command: grep -c '^-a always,exit -F arch=b32 -S adjtimex -S settimeofday -S stime -k time-change' /etc/audit/audit.rules
        expected: "1"
      - command: grep -c '^-a always,exit -F arch=b64 -S clock_settime -k time-change' /etc/audit/audit.rules
        expected: "1"
      - command: grep -c '^-a always,exit -F arch=b32 -S clock_settime -k time-change' /etc/audit/audit.rules
        expected: "1"
      - command: grep -c '^-w /etc/localtime -p wa -k time-change' /etc/audit/audit.rules
        expected: "1"
  rule_4_1_7:
    description: 4.1.7 Ensure events that modify the system's Mandatory Access Controls are collected
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: grep -c '^-w /etc/selinux/ -p wa -k MAC-policy' /etc/audit/audit.rules
        expected: "1"
      - command: grep -c '^-w /usr/share/selinux/ -p wa -k MAC-policy' /etc/audit/audit.rules
        expected: "1"
  rule_4_1_8:
    description: 4.1.8 Ensure events that modify the system's network environment are collected
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: grep -c '^-a always,exit -F arch=b64 -S sethostname -S setdomainname -k system-locale' /etc/audit/audit.rules
        expected: "1"
      - command: grep -c '^-a always,exit -F arch=b32 -S sethostname -S setdomainname -k system-locale' /etc/audit/audit.rules
        expected: "1"
      - command: grep -c '^-w /etc/issue -p wa -k system-locale' /etc/audit/audit.rules
        expected: "1"
      - command: grep -c '^-w /etc/issue.net -p wa -k system-locale' /etc/audit/audit.rules
        expected: "1"
      - command: grep -c '^-w /etc/hosts -p wa -k system-locale' /etc/audit/audit.rules
        expected: "1"
      - command: grep -c '^-w /etc/sysconfig/network -p wa -k system-locale' /etc/audit/audit.rules
        expected: "1"
  rule_4_1_9:
    description: 4.1.9 Ensure discretionary access control permission modification events are collected
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: grep -c '^-a always,exit -F arch=b64 -S chmod -S fchmod -S fchmodat -F auid>=1000 -F auid!=4294967295 -k perm_mod' /etc/audit/audit.rules
        expected: "1"
      - command: grep -c '^-a always,exit -F arch=b32 -S chmod -S fchmod -S fchmodat -F auid>=1000 -F auid!=4294967295 -k perm_mod' /etc/audit/audit.rules
        expected: "1"
      - command: grep -c '^-a always,exit -F arch=b64 -S chown -S fchown -S fchownat -S lchown -F auid>=1000 -F auid!=4294967295 -k perm_mod' /etc/audit/audit.rules
        expected: "1"
      - command: grep -c '^-a always,exit -F arch=b32 -S chown -S fchown -S fchownat -S lchown -F auid>=1000 -F auid!=4294967295 -k perm_mod' /etc/audit/audit.rules
        expected: "1"
      - command: grep -c '^-a always,exit -F arch=b64 -S setxattr -S lsetxattr -S fsetxattr -S removexattr -S lremovexattr -S fremovexattr -F auid>=1000 -F auid!=4294967295 -k perm_mod' /etc/audit/audit.rules
        expected: "1"
      - command: grep -c '^-a always,exit -F arch=b32 -S setxattr -S lsetxattr -S fsetxattr -S removexattr -S lremovexattr -S fremovexattr -F auid>=1000 -F auid!=4294967295 -k perm_mod' /etc/audit/audit.rules
        expected: "1"
  rule_4_1_10:
    description: 4.1.10 Ensure unsuccessful unauthorized file access attempts are collected
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: grep -c '^-a always,exit -F arch=b64 -S creat -S open -S openat -S truncate -S ftruncate -F exit=-EACCES -F auid>=1000 -F auid!=4294967295 -k access' /etc/audit/audit.rules
        expected: "1"
      - command: grep -c '^-a always,exit -F arch=b32 -S creat -S open -S openat -S truncate -S ftruncate -F exit=-EACCES -F auid>=1000 -F auid!=4294967295 -k access' /etc/audit/audit.rules
        expected: "1"
      - command: grep -c '^-a always,exit -F arch=b64 -S creat -S open -S openat -S truncate -S ftruncate -F exit=-EPERM -F auid>=1000 -F auid!=4294967295 -k access' /etc/audit/audit.rules
        expected: "1"
      - command: grep -c '^-a always,exit -F arch=b32 -S creat -S open -S openat -S truncate -S ftruncate -F exit=-EPERM -F auid>=1000 -F auid!=4294967295 -k access' /etc/audit/audit.rules
        expected: "1"
  rule_4_1_11:
    description: 4.1.11 Ensure events that modify user/group information are collected
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: grep -c '^-w /etc/group -p wa -k identity' /etc/audit/audit.rules
        expected: "1"
      - command: grep -c '^-w /etc/passwd -p wa -k identity' /etc/audit/audit.rules
        expected: "1"
      - command: grep -c '^-w /etc/gshadow -p wa -k identity' /etc/audit/audit.rules
        expected: "1"
      - command: grep -c '^-w /etc/shadow -p wa -k identity' /etc/audit/audit.rules
        expected: "1"
      - command: grep -c '^-w /etc/security/opasswd -p wa -k identity' /etc/audit/audit.rules
        expected: "1"
  rule_4_1_12:
    description: 4.1.12 Ensure successful file system mounts are collected
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: grep -c '^-a always,exit -F arch=b64 -S mount -F auid>=1000 -F auid!=4294967295 -k mounts' /etc/audit/audit.rules
        expected: "1"
      - command: grep -c '^-a always,exit -F arch=b32 -S mount -F auid>=1000 -F auid!=4294967295 -k mounts' /etc/audit/audit.rules
        expected: "1"
  rule_4_1_13:
    description: 4.1.13 Ensure use of privileged commands is collected
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: grep -c '^-a always,exit -F path=/usr/bin/chage -F perm=x -F auid>=1000 -F auid!=4294967295 -k privileged' /etc/audit/audit.rules
        expected: "1"
      - command: grep -c '^-a always,exit -F path=/usr/bin/gpasswd -F perm=x -F auid>=1000 -F auid!=4294967295 -k privileged' /etc/audit/audit.rules
        expected: "1"
      - command: grep -c '^-a always,exit -F path=/usr/bin/newgrp -F perm=x -F auid>=1000 -F auid!=4294967295 -k privileged' /etc/audit/audit.rules
        expected: "1"
      - command: grep -c '^-a always,exit -F path=/usr/bin/mount -F perm=x -F auid>=1000 -F auid!=4294967295 -k privileged' /etc/audit/audit.rules
        expected: "1"
      - command: grep -c '^-a always,exit -F path=/usr/bin/su -F perm=x -F auid>=1000 -F auid!=4294967295 -k privileged' /etc/audit/audit.rules
        expected: "1"
      - command: grep -c '^-a always,exit -F path=/usr/bin/umount -F perm=x -F auid>=1000 -F auid!=4294967295 -k privileged' /etc/audit/audit.rules
        expected: "1"
      - command: grep -c '^-a always,exit -F path=/usr/bin/write -F perm=x -F auid>=1000 -F auid!=4294967295 -k privileged' /etc/audit/audit.rules
        expected: "1"
      - command: grep -c '^-a always,exit -F path=/usr/bin/passwd -F perm=x -F auid>=1000 -F auid!=4294967295 -k privileged' /etc/audit/audit.rules
        expected: "1"
      - command: grep -c '^-a always,exit -F path=/usr/bin/sudo -F perm=x -F auid>=1000 -F auid!=4294967295 -k privileged' /etc/audit/audit.rules
        expected: "1"
      - command: grep -c '^-a always,exit -F path=/usr/bin/pkexec -F perm=x -F auid>=1000 -F auid!=4294967295 -k privileged' /etc/audit/audit.rules
        expected: "1"
      - command: grep -c '^-a always,exit -F path=/usr/bin/crontab -F perm=x -F auid>=1000 -F auid!=4294967295 -k privileged' /etc/audit/audit.rules
        expected: "1"
      - command: grep -c '^-a always,exit -F path=/usr/sbin/grub2-set-bootflag -F perm=x -F auid>=1000 -F auid!=4294967295 -k privileged' /etc/audit/audit.rules
        expected: "1"
      - command: grep -c '^-a always,exit -F path=/usr/sbin/unix_chkpwd -F perm=x -F auid>=1000 -F auid!=4294967295 -k privileged' /etc/audit/audit.rules
        expected: "1"
      - command: grep -c '^-a always,exit -F path=/usr/sbin/pam_timestamp_check -F perm=x -F auid>=1000 -F auid!=4294967295 -k privileged' /etc/audit/audit.rules
        expected: "1"
      - command: grep -c '^-a always,exit -F path=/usr/sbin/userhelper -F perm=x -F auid>=1000 -F auid!=4294967295 -k privileged' /etc/audit/audit.rules
        expected: "1"
      - command: grep -c '^-a always,exit -F path=/usr/lib/polkit-1/polkit-agent-helper-1 -F perm=x -F auid>=1000 -F auid!=4294967295 -k privileged' /etc/audit/audit.rules
        expected: "1"
      - command: grep -c '^-a always,exit -F path=/usr/libexec/dbus-1/dbus-daemon-launch-helper -F perm=x -F auid>=1000 -F auid!=4294967295 -k privileged' /etc/audit/audit.rules
        expected: "1"
      - command: grep -c '^-a always,exit -F path=/usr/libexec/utempter/utempter -F perm=x -F auid>=1000 -F auid!=4294967295 -k privileged' /etc/audit/audit.rules
        expected: "1"
      - command: grep -c '^-a always,exit -F path=/usr/libexec/openssh/ssh-keysign -F perm=x -F auid>=1000 -F auid!=4294967295 -k privileged' /etc/audit/audit.rules
        expected: "1"
  rule_4_1_14:
    description: 4.1.14 Ensure file deletion events by users are collected
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: grep -c '^-a always,exit -F arch=b64 -S unlink -S unlinkat -S rename -S renameat -F auid>=1000 -F auid!=4294967295 -k delete' /etc/audit/audit.rules
        expected: "1"
      - command: grep -c '^-a always,exit -F arch=b32 -S unlink -S unlinkat -S rename -S renameat -F auid>=1000 -F auid!=4294967295 -k delete' /etc/audit/audit.rules
        expected: "1"
  rule_4_1_15:
    description: 4.1.15 Ensure kernel module loading and unloading is collected
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: grep -c '^-w /sbin/insmod -p x -k modules' /etc/audit/audit.rules
        expected: "1"
      - command: grep -c '^-w /sbin/rmmod -p x -k modules' /etc/audit/audit.rules
        expected: "1"
      - command: grep -c '^-w /sbin/modprobe -p x -k modules' /etc/audit/audit.rules
        expected: "1"
      - command: grep -c '^-a always,exit -F arch=b64 -S init_module -S delete_module -k modules' /etc/audit/audit.rules
        expected: "1"
  rule_4_1_16:
    description: 4.1.16 Ensure system administrator actions (sudolog) are collected
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: grep -c '^-w /var/log/sudo.log -p wa -k actions' /etc/audit/audit.rules
        expected: "1"
  rule_4_1_17:
    description: 4.1.17 Ensure the audit configuration is immutable
    enabled: false
    observations: "intentionally disabled"
    scored: true
    severity: medium
    status: ''
    check:
      - command: grep "^\s*[^#]" /etc/audit/rules.d/audit.rules | tail -1|grep -c '^-e 2'
        expected: "1"
  rule_4_2_1_1:
    description: 4.2.1.1 Ensure rsyslog is installed
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: if [[ -f /tmp/rpm_packages ]]; then grep -c rsyslog /tmp/rpm_packages; else touch ./skip_rpm; fi
        expected: "0"
        parameter: '-gt'
  rule_4_2_1_2:
    description: 4.2.1.2 Ensure rsyslog Service is enabled
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: systemctl is-enabled rsyslog.service 2>/dev/null | grep -c enabled
        expected: "1"
  rule_4_2_1_3:
    description: 4.2.1.3 Ensure rsyslog default file permissions configured
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: grep -c ^\$FileCreateMode /etc/rsyslog.conf
        expected: "0"
        parameter: '-gt'
  rule_4_2_1_4:
    description: 4.2.1.4 Ensure logging is configured (Not Scored)
    enabled: false
    observations: "products will take care of correctly configuring their syslog component if necessary"
    not_supported: true
    scored: false
    severity: medium
    status: ''
  rule_4_2_1_5:
    description: 4.2.1.5 Ensure rsyslog is configured to send logs to a remote log host
    enabled: false
    observations: "no log server available"
    not_supported: true
    scored: true
    severity: medium
    status: ''
  rule_4_2_1_6:
    description: 4.2.1.6 Ensure remote rsyslog messages are only accepted on designated log hosts. (Not Scored)
    enabled: false
    observations: "no log server available (this check apply to logs servers only)"
    not_supported: true
    scored: false
    severity: medium
    status: ''
  rule_4_2_2_1:
    description: 4.2.2.1 Ensure journald is configured to send logs to rsyslog
    enabled: true
    scored: true
    severity: low
    status: ''
    check:
      - command: grep -ic 'ForwardToSyslog\s*=\s*yes' /etc/systemd/journald.conf
        expected: "0"
        parameter: '-gt'
  rule_4_2_2_2:
    description: 4.2.2.2 Ensure journald is configured to compress large log files
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: grep -ic 'Compress\s*=\s*yes' /etc/systemd/journald.conf
        expected: "0"
        parameter: '-gt'
  rule_4_2_2_3:
    description: 4.2.2.3 Ensure journald is configured to write logfiles to persistent disk
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: grep -ic '^Storage\s*=\s*persistent' /etc/systemd/journald.conf
        expected: "1"
  rule_4_2_3:
    description: 4.2.3 Ensure permissions on all logfiles are configured
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: find /var/log/ -type f -perm /g+w | wc -l
        expected: "0"
  rule_4_3:
    description: 4.3 Ensure logrotate is configured (Not Scored)
    enabled: false
    observations: "products will take care of correctly configuring their logrotate component if necessary"
    not_supported: true
    scored: false
    severity: medium
    status: ''

  rule_5_1_1:
    description: 5.1.1 Ensure cron daemon is enabled
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: "systemctl is-enabled crond 2>/dev/null | grep -c enabled"
        expected: "1"
  rule_5_1_2:
    description: 5.1.2 Ensure permissions on /etc/crontab are configured
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: stat /etc/crontab| grep -c 'Access:\s*(0600/-rw-------)\s*Uid:.*root.*Gid:.*root)$'
        expected: "1"
  rule_5_1_3:
    description: 5.1.3 Ensure permissions on /etc/cron.hourly are configured
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: stat /etc/cron.hourly| grep -c 'Access:\s*(0700/drwx------)\s*Uid:.*root.*Gid:.*root)$'
        expected: "1"
  rule_5_1_4:
    description: 5.1.4 Ensure permissions on /etc/cron.daily are configured
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: stat /etc/cron.daily| grep -c 'Access:\s*(0700/drwx------)\s*Uid:.*root.*Gid:.*root)$'
        expected: "1"
  rule_5_1_5:
    description: 5.1.5 Ensure permissions on /etc/cron.weekly are configured
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: stat /etc/cron.weekly| grep -c 'Access:\s*(0700/drwx------)\s*Uid:.*root.*Gid:.*root)$'
        expected: "1"
  rule_5_1_6:
    description: 5.1.6 Ensure permissions on /etc/cron.monthly are configured
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: stat /etc/cron.monthly| grep -c 'Access:\s*(0700/drwx------)\s*Uid:.*root.*Gid:.*root)$'
        expected: "1"
  rule_5_1_7:
    description: 5.1.7 Ensure permissions on /etc/cron.d are configured
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: stat /etc/cron.d| grep -c 'Access:\s*(0700/drwx------)\s*Uid:.*root.*Gid:.*root)$'
        expected: "1"
  rule_5_1_8:
    description: 5.1.8 Ensure at/cron is restricted to authorized users
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: stat /etc/cron.allow| grep -c 'Access:\s*(0600/-rw-------)\s*Uid:.*root.*Gid:.*root)$'
        expected: "1"
      - command: stat /etc/at.allow| grep -c 'Access:\s*(0600/-rw-------)\s*Uid:.*root.*Gid:.*root)$'
        expected: "1"
  rule_5_2_1:
    description: 5.2.1 Ensure permissions on /etc/ssh/sshd_config are configured
    enabled: true
    scored: true
    severity: critical
    status: ''
    check:
      - command: stat /etc/ssh/sshd_config| grep -c 'Access:\s*(0600/-rw-------)\s*Uid:.*root.*Gid:.*root)$'
        expected: "1"
  rule_5_2_2:
    description: 5.2.2 Ensure SSH access is limited
    enabled: false
    observations: "list of permitted and denied users does not exists"
    scored: true
    severity: medium
    status: ''
  rule_5_2_3:
    description: 5.2.3 Ensure permissions on SSH private host key files are configured
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: find /etc/ssh -xdev -type f -name 'ssh_host_*_key' ! -perm 0600|wc -l
        expected: "0"
      - command: find /etc/ssh -xdev -type f -name 'ssh_host_*_key' ! -user 0|wc -l
        expected: "0"
      - command: find /etc/ssh -xdev -type f -name 'ssh_host_*_key' ! -group 0|wc -l
        expected: "0"
  rule_5_2_4:
    description: 5.2.4 Ensure permissions on SSH public host key files are configured
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: find /etc/ssh -xdev -type f -name 'ssh_host_*_key.pub' ! -perm 0644|wc -l
        expected: "0"
      - command: find /etc/ssh -xdev -type f -name 'ssh_host_*_key.pub' ! -user 0|wc -l
        expected: "0"
      - command: find /etc/ssh -xdev -type f -name 'ssh_host_*_key.pub' ! -group 0|wc -l
        expected: "0"
  rule_5_2_5:
    description: 5.2.5 Ensure SSH LogLevel is appropriate
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: sshd -T -C user=* 2>/dev/null| grep -Ec 'loglevel\s*(VERBOSE|INFO)'
        expected: "1"
  rule_5_2_6:
    description: 5.2.6 Ensure SSH X11 forwarding is disabled
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: sshd -T -C user=* 2>/dev/null| grep -Eic 'X11Forwarding\s*no'
        expected: "1"
  rule_5_2_7:
    description: 5.2.7 Ensure SSH MaxAuthTries is set to 4 or less
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: sshd -T -C user=* 2>/dev/null| grep -Eic 'MaxAuthTries\s*4'
        expected: "1"
  rule_5_2_8:
    description: 5.2.8 Ensure SSH IgnoreRhosts is enabled
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: sshd -T -C user=* 2>/dev/null| grep -Eic 'IgnoreRhosts\s*yes'
        expected: "1"
  rule_5_2_9:
    description: 5.2.9 Ensure SSH HostbasedAuthentication is disabled
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: sshd -T -C user=* 2>/dev/null| grep -Eic 'HostbasedAuthentication\s*no'
        expected: "1"
  rule_5_2_10:
    description: 5.2.10 Ensure SSH root login is disabled
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: sshd -T -C user=* 2>/dev/null| grep -Eic 'PermitRootLogin\s*no'
        expected: "1"
  rule_5_2_11:
    description: 5.2.11 Ensure SSH PermitEmptyPasswords is disabled
    enabled: true
    scored: true
    severity: critical
    status: ''
    check:
      - command: sshd -T -C user=* 2>/dev/null| grep -Eic 'PermitEmptyPasswords\s*no'
        expected: "1"
  rule_5_2_12:
    description: 5.2.12 Ensure SSH PermitUserEnvironment is disabled
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: sshd -T -C user=* 2>/dev/null| grep -Eic 'PermitUserEnvironment\s*no'
        expected: "1"
  rule_5_2_13:
    description: 5.2.13 Ensure SSH Idle Timeout Interval is configured
    enabled: true
    observations: "value intentionally set to 1800"
    scored: true
    severity: medium
    status: ''
    check:
      - command: sshd -T -C user=* 2>/dev/null| grep -Eic 'ClientAliveInterval\s*1800'
        expected: "1"
      - command: sshd -T -C user=* 2>/dev/null| grep -Eic 'ClientAliveCountMax\s*0'
        expected: "1"
  rule_5_2_14:
    description: 5.2.14 Ensure SSH LoginGraceTime is set to one minute or less
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: sshd -T -C user=* 2>/dev/null| grep -Eic 'LoginGraceTime\s*60'
        expected: "1"
  rule_5_2_15:
    description: 5.2.15 Ensure SSH warning banner is configured
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: sshd -T -C user=* 2>/dev/null| grep -Eic '^Banner\s*/etc/issue.net'
        expected: "1"
  rule_5_2_16:
    description: 5.2.16 Ensure SSH PAM is enabled
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: sshd -T -C user=* 2>/dev/null| grep -Eic '^UsePAM\s*yes'
        expected: "1"
  rule_5_2_17:
    description: 5.2.17 Ensure SSH AllowTcpForwarding is disabled
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: sshd -T -C user=* 2>/dev/null| grep -Eic '^AllowTcpForwarding\s*no'
        expected: "1"
  rule_5_2_18:
    description: 5.2.18 Ensure SSH MaxStartups is configured
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: sshd -T -C user=* 2>/dev/null| grep -Eic '^MaxStartups\s*10:30:60'
        expected: "1"
  rule_5_2_19:
    description: 5.2.19 Ensure SSH MaxSessions is set to 4 or less
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: sshd -T -C user=* 2>/dev/null| grep -Eic '^MaxSessions\s*4'
        expected: "1"
  rule_5_2_20:
    description: 5.2.20 Ensure system-wide crypto policy is not over-ridden
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: grep -c '^/s*CRYPTO_POLICY=' /etc/sysconfig/sshd
        expected: "0"
  rule_5_3_1:
    description: 5.3.1 Create custom authselect profile
    enabled: true
    scored: true
    severity: low
    status: ''
    check:
      - command: "authselect current | grep -c 'Profile ID: custom/IES'"
        expected: "1"
  rule_5_3_2:
    description: 5.3.2 Select authselect profile
    enabled: true
    scored: true
    severity: low
    status: ''
    check:
      - command: "authselect current | grep -c 'Profile ID: custom/IES'"
        expected: "1"
  rule_5_3_3:
    description: 5.3.3 Ensure authselect includes with-faillock
    enabled: true
    scored: true
    severity: low
    status: ''
    check:
      - command: authselect current | grep -c with-faillock
        expected: "1"
  rule_5_4_1:
    description: 5.4.1 Ensure password creation requirements are configured
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: grep -c pam_pwquality.so /etc/pam.d/password-auth
        expected: "1"
      - command: grep -c pam_pwquality.so /etc/pam.d/system-auth
        expected: "1"
      - command: grep -Ec '^minlen\s*=\s*(14|15)' /etc/security/pwquality.conf
        expected: "1"
      - command: grep -c '^dcredit\s*=\s*-1' /etc/security/pwquality.conf
        expected: "1"
      - command: grep -c '^lcredit\s*=\s*-1' /etc/security/pwquality.conf
        expected: "1"
      - command: grep -c '^ocredit\s*=\s*-1' /etc/security/pwquality.conf
        expected: "1"
      - command: grep -c '^ucredit\s*=\s*-1' /etc/security/pwquality.conf
        expected: "1"
  rule_5_4_2:
    description: 5.4.2 Ensure lockout for failed password attempts is configured
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: grep -c 'auth\s*required\s*pam_faillock.so\s*preauth\s*silent\s*deny=5\s*unlock_time=900' /etc/pam.d/password-auth
        expected: "1"
      - command: grep -c 'auth\s*required\s*pam_faillock.so\s*authfail\s*deny=5\s*unlock_time=900' /etc/pam.d/password-auth
        expected: "1"
      - command: grep -c 'auth\s*required\s*pam_faillock.so\s*preauth\s*silent\s*deny=5\s*unlock_time=900' /etc/pam.d/system-auth
        expected: "1"
      - command: grep -c 'auth\s*required\s*pam_faillock.so\s*authfail\s*deny=5\s*unlock_time=900' /etc/pam.d/system-auth
        expected: "1"
  rule_5_4_3:
    description: 5.4.3 Ensure password reuse is limited
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: grep -Ec '^\s*password\s+(requisite|sufficient)\s+(pam_pwquality\.so|pam_unix\.so)\s+.*remember=([5-9]|[1-4][0-9])[0-9]*\s*.*$' /etc/pam.d/system-auth
        expected: "2"
  rule_5_4_4:
    description: 5.4.4 Ensure password hashing algorithm is SHA-512
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: grep -Ec '^\s*password\s+sufficient\s+pam_unix.so\s+.*sha512\s*.*$' /etc/pam.d/password-auth
        expected: "1"
      - command: grep -Ec '^\s*password\s+sufficient\s+pam_unix.so\s+.*sha512\s*.*$' /etc/pam.d/system-auth
        expected: "1"
  rule_5_5_1_1:
    description: 5.5.1.1 Ensure password expiration is 365 days or less
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: grep ^PASS_MAX_DAYS /etc/login.defs| awk '{print $NF}'
        expected: "42"
        parameter: '-le'
  rule_5_5_1_2:
    description: 5.5.1.2 Ensure minimum days between password changes is 7 or more
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: grep ^PASS_MIN_DAYS /etc/login.defs| awk '{print $NF}'
        expected: "7"
        parameter: '-ge'
  rule_5_5_1_3:
    description: 5.5.1.3 Ensure password expiration warning days is 7 or more
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: grep ^PASS_WARN_AGE /etc/login.defs| awk '{print $NF}'
        expected: "7"
        parameter: '-ge'
  rule_5_5_1_4:
    description: 5.5.1.4 Ensure inactive password lock is 30 days or less
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: grep ^INACTIVE /etc/default/useradd| awk -F '=' '{print $NF}'
        expected: "30"
        parameter: '-le'
  rule_5_5_1_5:
    description: 5.5.1.5 Ensure all users last password change date is in the past
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: |
          for usr in $(cut -d: -f1 /etc/shadow); do [ $(chage --list $usr | grep '^Last password change' | cut -d: -f2| date -d - +%s) -ge $(date +%s) ] && echo "$usr :$(chage --list $usr | grep '^Last password change' | cut -d: -f2)"; done|wc -l
        expected: "0"
  rule_5_5_2:
    description: 5.5.2 Ensure system accounts are secured
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: |
          awk -F: '($1!="root" && $1!="sync" && $1!="shutdown" && $1!="halt" && $1!~/^\+/ && $3<'"$(awk '/^\s*UID_MIN/{print $2}' /etc/login.defs)"' && $7!="'"$(which nologin)"'" && $7!="/sbin/nologin") {print}' /etc/passwd|wc -l
        expected: "0"
      - command: |
          awk -F: '($1!="root" && $1!~/^\+/ && $3<'"$(awk '/^\s*UID_MIN/{print $2}' /etc/login.defs)"') {print $1}' /etc/passwd | xargs -I '{}' passwd -S '{}' | awk '($2!="L" && $2!="LK") {print $1}'|wc -l
        expected: "0"
  rule_5_5_3:
    description: 5.5.3 Ensure default user shell timeout is 900 seconds or less
    enabled: true
    observations: "value intentionally set to 1800"
    scored: true
    severity: medium
    status: ''
    check:
      - command: grep -c "readonly TMOUT=1800 ; export TMOUT" /etc/profile.d/tmout.sh
        expected: "1"
  rule_5_5_4:
    description: 5.5.4 Ensure default group for the root account is GID 0
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: "grep '^root:' /etc/passwd | cut -f4 -d:"
        expected: "0"
  rule_5_5_5:
    description: 5.5.5 Ensure default user umask is 027 or more restrictive
    enabled: true
    scored: true
    severity: low
    status: ''
    check:
      - command: grep "^\s*umask\s*0[0-6][0-6]" /etc/profile /etc/profile.d/*.sh | wc -l
        expected: "0"
      - command: grep "^\s*umask\s*0[0-6][0-6]" /etc/bashrc | wc -l
        expected: "0"
  rule_5_6:
    description: 5.6 Ensure root login is restricted to system console (Not Scored)
    enabled: true
    scored: false
    severity: medium
    status: ''
    check:
      - command: cat /etc/securetty  2>/dev/null| wc -l
        expected: "0"
  rule_5_7:
    description: 5.7 Ensure access to the su command is restricted
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: grep -c '^auth\s*required\s*pam_wheel.so\s*use_uid$' /etc/pam.d/su
        expected: "1"

  rule_6_1_1:
    description: 6.1.1 Audit system file permissions (Not Scored)
    enabled: false
    observations: "configuration files are modified during the image build, too many false positive are returned by this check"
    scored: false
    not_supported: true
    severity: critical
    status: ''
  rule_6_1_2:
    description: 6.1.2 Ensure permissions on /etc/passwd are configured
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: stat /etc/passwd| grep -c 'Access:\s*(0644/-rw-r--r--)\s*Uid:.*root.*Gid:.*root)$'
        expected: "1"
  rule_6_1_3:
    description: 6.1.3 Ensure permissions on /etc/shadow are configured
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: stat /etc/shadow| grep -c 'Access:\s*(0000/----------)\s*Uid:.*root.*Gid:.*root)$'
        expected: "1"
  rule_6_1_4:
    description: 6.1.4 Ensure permissions on /etc/group are configured
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: stat /etc/group| grep -c 'Access:\s*(0644/-rw-r--r--)\s*Uid:.*root.*Gid:.*root)$'
        expected: "1"
  rule_6_1_5:
    description: 6.1.5 Ensure permissions on /etc/gshadow are configured
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: stat /etc/gshadow| grep -c 'Access:\s*(0000/----------)\s*Uid:.*root.*Gid:.*root)$'
        expected: "1"
  rule_6_1_6:
    description: 6.1.6 Ensure permissions on /etc/passwd- are configured
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: stat /etc/passwd-| grep -c 'Access:\s*(0644/-rw-r--r--)\s*Uid:.*root.*Gid:.*root)$'
        expected: "1"
  rule_6_1_7:
    description: 6.1.7 Ensure permissions on /etc/shadow- are configured
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: stat /etc/shadow-| grep -c 'Access:\s*(0000/----------)\s*Uid:.*root.*Gid:.*root)$'
        expected: "1"
  rule_6_1_8:
    description: 6.1.8 Ensure permissions on /etc/group- are configured
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: stat /etc/group-| grep -c 'Access:\s*(0644/-rw-r--r--)\s*Uid:.*root.*Gid:.*root)$'
        expected: "1"
  rule_6_1_9:
    description: 6.1.9 Ensure permissions on /etc/gshadow- are configured
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: stat /etc/gshadow-| grep -c 'Access:\s*(0000/----------)\s*Uid:.*root.*Gid:.*root)$'
        expected: "1"
  rule_6_1_10:
    description: 6.1.10 Ensure no world writable files exist
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: df --local -P | awk '{if (NR!=1) print $6}' | xargs -I '{}' find '{}' -xdev -type f -perm -0002|wc -l
        expected: "0"
  rule_6_1_11:
    description: 6.1.11 Ensure no unowned files or directories exist
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: df --local -P | awk {'if (NR!=1) print $6'} | xargs -I '{}' find '{}' -xdev -nouser|wc -l
        expected: "0"
  rule_6_1_12:
    description: 6.1.12 Ensure no ungrouped files or directories exist
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: df --local -P | awk '{if (NR!=1) print $6}' | xargs -I '{}' find '{}' -xdev -nogroup|wc -l
        expected: "0"
  rule_6_1_13:
    description: 6.1.13 Audit SUID executables (Not Scored)
    enabled: false
    observations: "no defined list of SUID executables"
    not_supported: true
    scored: false
    severity: medium
    status: ''
  rule_6_1_14:
    description: 6.1.14 Audit SGID executables (Not Scored)
    enabled: false
    observations: "no defined list of SGID executables"
    not_supported: true
    scored: false
    severity: medium
    status: ''
  rule_6_2_1:
    description: 6.2.1 Ensure password fields are not empty
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: |
          awk -F: '($2 == "" ) { print $1 " does not have a password "}' /etc/shadow|wc -l
        expected: "0"
  rule_6_2_2:
    description: 6.2.2 Ensure no legacy '+' entries exist in /etc/passwd
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: grep -c '^\+:' /etc/passwd
        expected: "0"
  rule_6_2_3:
    description: 6.2.3 Ensure root PATH Integrity
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: |
          for x in $(echo $PATH | tr ":" " ") ; do
            if [ -d "$x" ] ; then
              ls -ldH "$x" | awk '
          $9 == "." {print "PATH contains current working directory (.)"}
          $3 != "root" {print $9, "is not owned by root"}
          substr($1,6,1) != "-" {print $9, "is group writable"}
          substr($1,9,1) != "-" {print $9, "is world writable"}'
            else
              echo "$x is not a directory"
            fi
          done|wc -l
        expected: "0"
  rule_6_2_4:
    description: 6.2.4 Ensure no legacy '+' entries exist in /etc/shadow
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: grep -c '^\+:' /etc/shadow
        expected: "0"
  rule_6_2_5:
    description: 6.2.5 Ensure no legacy '+' entries exist in /etc/group
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: grep -c '^\+:' /etc/group
        expected: "0"
  rule_6_2_6:
    description: 6.2.6 Ensure root is the only UID 0 account
    enabled: true
    scored: true
    severity: critical
    status: ''
    check:
      - command: "awk -F: '($3 == 0) { print $1 }' /etc/passwd| grep -c root"
        expected: "1"
  rule_6_2_7:
    description: 6.2.7 Ensure users' home directories permissions are 750 or more restrictive
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: |
          #!/bin/bash
          grep -E -v '^(halt|sync|shutdown)' /etc/passwd | awk -F: '($7 != "'"$(which nologin)"'" && $7 != "/sbin/nologin") { print $1 " " $6 }' | while read user dir; do
            if [ ! -d "$dir" ]; then
              echo "The home directory ($dir) of user $user does not exist."
            else
              dirperm=$(ls -ld $dir | cut -f1 -d" ")
              if [ $(echo $dirperm | cut -c6) != "-" ]; then
                echo "Group Write permission set on the home directory ($dir) of user $user"
              fi
              if [ $(echo $dirperm | cut -c8) != "-" ]; then
                echo "Other Read permission set on the home directory ($dir) of user $user"
              fi
              if [ $(echo $dirperm | cut -c9) != "-" ]; then
                echo "Other Write permission set on the home directory ($dir) of user $user"
              fi
              if [ $(echo $dirperm | cut -c10) != "-" ]; then
                echo "Other Execute permission set on the home directory ($dir) of user $user"
              fi
            fi
          done|wc -l
        expected: "0"
  rule_6_2_8:
    description: 6.2.8 Ensure users own their home directories
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: |
          #!/bin/bash

          grep -E -v '^(halt|sync|shutdown)' /etc/passwd | awk -F: '($7 != "'"$(which nologin)"'" && $7 != "/sbin/nologin") { print $1 " " $6 }' | while read user dir; do
            if [ ! -d "$dir" ]; then
              echo "The home directory ($dir) of user $user does not exist."
            else
            owner=$(stat -L -c "%U" "$dir")
            if [ "$owner" != "$user" ]; then
              echo "The home directory ($dir) of user $user is owned by $owner."
            fi
          fi
          done|wc -l
        expected: "0"
  rule_6_2_9:
    description: 6.2.9 Ensure users' dot files are not group or world writable
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: |
          #!/bin/bash

          grep -E -v '^(halt|sync|shutdown)' /etc/passwd | awk -F: '($7 != "'"$(which nologin)"'" && $7 != "/sbin/nologin") { print $1 " " $6 }' | while read user dir; do
            if [ ! -d "$dir" ]; then
              echo "The home directory ($dir) of user $user does not exist."
            else
              for file in $dir/.[A-Za-z0-9]*; do
                if [ ! -h "$file" -a -f "$file" ]; then
                  fileperm=$(ls -ld $file | cut -f1 -d" ")

                  if [ $(echo $fileperm | cut -c6)  != "-" ]; then
                    echo "Group Write permission set on file $file"
                  fi
                  if [ $(echo $fileperm | cut -c9)  != "-" ]; then
                    echo "Other Write permission set on file $file"
                  fi
                fi
              done
            fi
          done|wc -l
        expected: "0"
  rule_6_2_10:
    description: 6.2.10 Ensure no users have .forward files
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: |
          #!/bin/bash

          grep -E -v '^(root|halt|sync|shutdown)' /etc/passwd | awk -F: '($7 != "'"$(which nologin)"'" && $7 != "/sbin/nologin") { print $1 " " $6 }' | while read user dir; do
            if [ ! -d "$dir" ]; then
              echo "The home directory ($dir) of user $user does not exist."
            else
              if [ ! -h "$dir/.forward" -a -f "$dir/.forward" ]; then
                echo ".forward file $dir/.forward exists"
              fi
            fi
          done|wc -l
        expected: "0"
  rule_6_2_11:
    description: 6.2.11 Ensure no users have .netrc files
    enabled: true
    scored: true
    severity: critical
    status: ''
    check:
      - command: |
          #!/bin/bash

          grep -E -v '^(root|halt|sync|shutdown)' /etc/passwd | awk -F: '($7 != "'"$(which nologin)"'" && $7 != "/sbin/nologin") { print $1 " " $6 }' | while read user dir; do
            if [ ! -d "$dir" ]; then
              echo "The home directory ($dir) of user $user does not exist."
            else
              if [ ! -h "$dir/.netrc" -a -f "$dir/.netrc" ]; then
                echo ".netrc file $dir/.netrc exists"
              fi
            fi
          done|wc -l
        expected: "0"
  rule_6_2_12:
    description: 6.2.12 Ensure users' .netrc Files are not group or world accessible
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: |
          #!/bin/bash

          grep -E -v '^(root|halt|sync|shutdown)' /etc/passwd | awk -F: '($7 != "'"$(which nologin)"'" && $7 != "/sbin/nologin") { print $1 " " $6 }' | while read user dir; do
            if [ ! -d "$dir" ]; then
              echo "The home directory ($dir) of user $user does not exist."
            else
              for file in $dir/.netrc; do
                if [ ! -h "$file" -a -f "$file" ]; then
                  fileperm=$(ls -ld $file | cut -f1 -d" ")
                  if [ $(echo $fileperm | cut -c5)  != "-" ]; then
                    echo "Group Read set on $file"
                  fi
                  if [ $(echo $fileperm | cut -c6)  != "-" ]; then
                    echo "Group Write set on $file"
                  fi
                  if [ $(echo $fileperm | cut -c7)  != "-" ]; then
                    echo "Group Execute set on $file"
                  fi
                  if [ $(echo $fileperm | cut -c8)  != "-" ]; then
                    echo "Other Read set on $file"
                  fi
                  if [ $(echo $fileperm | cut -c9)  != "-" ]; then
                    echo "Other Write set on $file"
                  fi
                  if [ $(echo $fileperm | cut -c10)  != "-" ]; then
                    echo "Other Execute set on $file"
                  fi
                fi
              done
            fi
          done|wc -l
        expected: "0"
  rule_6_2_13:
    description: 6.2.13 Ensure no users have .rhosts files
    enabled: true
    scored: true
    severity: critical
    status: ''
    check:
      - command: |
          #!/bin/bash

          grep -E -v '^(root|halt|sync|shutdown)' /etc/passwd | awk -F: '($7 != "'"$(which nologin)"'" && $7 != "/sbin/nologin") { print $1 " " $6 }' | while read user dir; do
            if [ ! -d "$dir" ]; then
              echo "The home directory ($dir) of user $user does not exist."
            else
              for file in $dir/.rhosts; do
                if [ ! -h "$file" -a -f "$file" ]; then
                  echo ".rhosts file in $dir"
                fi
              done
            fi
          done|wc -l
        expected: "0"
  rule_6_2_14:
    description: 6.2.14 Ensure all groups in /etc/passwd exist in /etc/group
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: |
          #!/bin/bash

          for i in $(cut -s -d: -f4 /etc/passwd | sort -u ); do
            grep -q -P "^.*?:[^:]*:$i:" /etc/group
            if [ $? -ne 0 ]; then
              echo "Group $i is referenced by /etc/passwd but does not exist in /etc/group"
            fi
          done|wc -l
        expected: "0"
  rule_6_2_15:
    description: 6.2.15 Ensure no duplicate UIDs exist
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: |
          #!/bin/bash

          cut -f3 -d":" /etc/passwd | sort -n | uniq -c | while read x ; do
            [ -z "$x" ] && break
            set - $x
            if [ $1 -gt 1 ]; then
              users=$(awk -F: '($3 == n) { print $1 }' n=$2 /etc/passwd | xargs)
              echo "Duplicate UID ($2): $users"
            fi
          done|wc -l
        expected: "0"
  rule_6_2_16:
    description: 6.2.16 Ensure no duplicate GIDs exist
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: |
          #!/bin/bash

          cut -d: -f3 /etc/group | sort | uniq -d | while read x ; do
              echo "Duplicate GID ($x) in /etc/group"
          done|wc -l
        expected: "0"
  rule_6_2_17:
    description: 6.2.17 Ensure no duplicate user names exist
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: |
          #!/bin/bash

          cut -d: -f1 /etc/passwd | sort | uniq -d | while read x
          do echo "Duplicate login name ${x} in /etc/passwd"
          done|wc -l
        expected: "0"
  rule_6_2_18:
    description: 6.2.18 Ensure no duplicate group names exist
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: |
          #!/bin/bash

          cut -d: -f1 /etc/group | sort | uniq -d | while read x
          do echo "Duplicate group name ${x} in /etc/group"
          done|wc -l
        expected: "0"
  rule_6_2_19:
    description: 6.2.19 Ensure shadow group is empty
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: grep ^shadow:[^:]*:[^:]*:[^:]+ /etc/group | wc -l
        expected: "0"
  rule_6_2_20:
    description: 6.2.20 Ensure all users' home directories exist
    enabled: true
    scored: true
    severity: medium
    status: ''
    check:
      - command: |
          #!/bin/bash
          grep -E -v '^(halt|sync|shutdown)' /etc/passwd | awk -F: '($7 != "'"$(which nologin)"'" && $7 != "/sbin/nologin") { print $1 " " $6 }' | while read -r user dir; do
            if [ ! -d "$dir" ]; then
              echo "The home directory ($dir) of user $user does not exist."
            fi
          done|wc -l
        expected: "0"


# Warning Banner Content (issue, issue.net, motd)
rhel8cis_warning_banner: | # Estos valores se encuentran igual que el hardening, revisar proximo q
  *****************************************************

  ### #######  #####
   #  #       #     #
   #  #       #
   #  #####    #####
   #  #             #
   #  #       #     #
  ### #######  #####
  *****************************************************

  UNAUTHORIZED ACCESS TO THIS DEVICE IS PROHIBITED

  You must have explicit, authorized permission to access or configure this device.
  Unauthorized attempts and actions to access or use this system may result in civil and/or criminal penalties.
  All activities performed on this device are logged and monitored.
# End Banner

# following variables need to be initialized
_mounted_partitions: [ ]
_inconsistent_rules: { }
